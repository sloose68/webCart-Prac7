import{as as d,gp as c,fe as m,W as n,X as f,ah as p,eY as g,Y as v,fm as y,gq as I,t as w}from"./ScaleRangeLayer-CkcnxI7v.js";const a=new d,i=new WeakMap;function b(t){C(t)&&a.push(new WeakRef(t))}function $(t){const e=a.find((s=>s.deref()===t));e&&a.remove(e)}function C(t){return t!=null&&typeof t=="object"&&"refreshInterval"in t&&"refresh"in t}function u(t,e){return Number.isFinite(t)&&Number.isFinite(e)?e<=0?t:u(e,t%e):0}let h=0,o=0;function D(){const t=Date.now();let e=!1;for(const s of a){const r=s.deref();r?r.refreshInterval&&t-(i.get(r)??0)+5>=6e4*r.refreshInterval&&(i.set(r,t),r.refresh(t)):e=!0}if(e)for(let s=a.length-1;s>=0;s--)a.at(s).deref()||a.removeAt(s)}c((()=>{const t=Date.now();let e=0;for(const s of a){const r=s.deref();r&&(e=u(Math.round(6e4*r.refreshInterval),e),r.refreshInterval?i.get(r)||i.set(r,t):i.delete(r))}if(e!==o){if(o=e,clearInterval(h),o===0)return void(h=0);h=setInterval(D,o)}}),m);const l=.1,R=t=>{let e=class extends t{constructor(...s){super(...s),this.refreshInterval=0,this.refreshTimestamp=0,this._debounceHasDataChanged=y((()=>this.hasDataChanged())),this.when().then((()=>{this.destroyed||b(this)}),(()=>{}))}destroy(){$(this)}castRefreshInterval(s){return s>=l?s:s<=0?0:l}get refreshParameters(){return{_ts:this.refreshTimestamp||null}}refresh(s=Date.now()){I(this._debounceHasDataChanged()).then((r=>{r&&this._set("refreshTimestamp",s),this.emit("refresh",{dataChanged:r})}),(r=>{w.getLogger(this).error(r),this.emit("refresh",{dataChanged:!1,error:r})}))}async hasDataChanged(){return!0}get test(){}};return n([f({type:Number,json:{write:!0,origins:{"web-scene":{write:{enabled:!0,layerContainerTypes:p}}}}})],e.prototype,"refreshInterval",void 0),n([g("refreshInterval")],e.prototype,"castRefreshInterval",null),n([f({readOnly:!0})],e.prototype,"refreshTimestamp",void 0),n([f({readOnly:!0})],e.prototype,"refreshParameters",null),e=n([v("esri.layers.mixins.RefreshableLayer")],e),e};export{R as f};
